<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalgona Candy Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Sunflower:wght@300;500;700&family=Zen+Dots&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Sunflower', sans-serif;
            --color-black: #080A0C;
            --color-beige: #d8c99b;
            --color-green: #68a691;
            --color-green-light: #a5cabe;
            --color-pink: #ca6680;
            --color-pink-light: #db95a7;
            background-color: var(--color-black);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2000 1500'%3E%3Cdefs%3E%3Crect stroke='%23080A0C' stroke-width='0.5' width='1' height='1' id='s'/%3E%3Cpattern id='a' width='3' height='3' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cuse fill='%23252526' href='%23s' y='2'/%3E%3Cuse fill='%23252526' href='%23s' x='1' y='2'/%3E%3Cuse fill='%23343434' href='%23s' x='2' y='2'/%3E%3Cuse fill='%23343434' href='%23s'/%3E%3Cuse fill='%233f3f40' href='%23s' x='2'/%3E%3Cuse fill='%233f3f40' href='%23s' x='1' y='1'/%3E%3C/pattern%3E%3Cpattern id='b' width='7' height='11' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23494949'%3E%3Cuse href='%23s'/%3E%3Cuse href='%23s' y='5' /%3E%3Cuse href='%23s' x='1' y='10'/%3E%3Cuse href='%23s' x='2' y='1'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='8'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='5' y='2'/%3E%3Cuse href='%23s' x='5' y='6'/%3E%3Cuse href='%23s' x='6' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='h' width='5' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23494949'%3E%3Cuse href='%23s' y='5'/%3E%3Cuse href='%23s' y='8'/%3E%3Cuse href='%23s' x='1' y='1'/%3E%3Cuse href='%23s' x='1' y='9'/%3E%3Cuse href='%23s' x='1' y='12'/%3E%3Cuse href='%23s' x='2'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='2'/%3E%3Cuse href='%23s' x='3' y='6'/%3E%3Cuse href='%23s' x='3' y='11'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='4' y='10'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='c' width='17' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23515151'%3E%3Cuse href='%23s' y='11'/%3E%3Cuse href='%23s' x='2' y='9'/%3E%3Cuse href='%23s' x='5' y='12'/%3E%3Cuse href='%23s' x='9' y='4'/%3E%3Cuse href='%23s' x='12' y='1'/%3E%3Cuse href='%23s' x='16' y='6'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='d' width='19' height='17' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23080A0C'%3E%3Cuse href='%23s' y='9'/%3E%3Cuse href='%23s' x='16' y='5'/%3E%3Cuse href='%23s' x='14' y='2'/%3E%3Cuse href='%23s' x='11' y='11'/%3E%3Cuse href='%23s' x='6' y='14'/%3E%3C/g%3E%3Cg fill='%23595959'%3E%3Cuse href='%23s' x='3' y='13'/%3E%3Cuse href='%23s' x='9' y='7'/%3E%3Cuse href='%23s' x='13' y='10'/%3E%3Cuse href='%23s' x='15' y='4'/%3E%3Cuse href='%23s' x='18' y='1'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='e' width='47' height='53' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23CA6680'%3E%3Cuse href='%23s' x='2' y='5'/%3E%3Cuse href='%23s' x='16' y='38'/%3E%3Cuse href='%23s' x='46' y='42'/%3E%3Cuse href='%23s' x='29' y='20'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='f' width='59' height='71' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23CA6680'%3E%3Cuse href='%23s' x='33' y='13'/%3E%3Cuse href='%23s' x='27' y='54'/%3E%3Cuse href='%23s' x='55' y='55'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='g' width='139' height='97' patternUnits='userSpaceOnUse' patternTransform='scale(18.25) translate(-945.21 -708.9)'%3E%3Cg fill='%23CA6680'%3E%3Cuse href='%23s' x='11' y='8'/%3E%3Cuse href='%23s' x='51' y='13'/%3E%3Cuse href='%23s' x='17' y='73'/%3E%3Cuse href='%23s' x='99' y='57'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect fill='url(%23a)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23b)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23h)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23c)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23d)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23e)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23f)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23g)' width='100%25' height='100%25'/%3E%3C/svg%3E");
            background-attachment: fixed;
            background-size: cover;
        }

        h1,
        h2 {
            margin: 0;
            margin-bottom: 1rem;
        }

        h1 {
            font-family: 'Zen Dots', cursive;
            font-size: 2rem;
        }

        h2 {
            font-size: 1.4rem;
            font-weight: 500;
            background-color: var(--color-beige);
            text-align: center;
            margin: 1rem 0 0 0;
        }

        button {
            border: 0;
            box-shadow: none;
            font-family: 'Sunflower', sans-serif;
            font-weight: 500;
        }

        button:hover,
        button:focus {
            cursor: pointer;
        }

        .container {
            width: 98%;
            max-width: 500px;
            margin: 0 auto;
        }

        .container-canvas {
            width: 370px;
            height: 370px;
            margin: 3em auto 0;
            position: relative;
        }

        canvas {
            display: block;
            border-radius: 50%;
            border: 2px solid var(--color-green);
            box-shadow: 0 0 4px 4px #060c15; 
            width: 370px;
            height: 370px;
            background-color: #c1b36c;
            background: #c4b56f;
            background: -moz-radial-gradient(center, ellipse cover,  #c4b56f 0%, #c1a94f 62%, #6b4c14 90%, #c1a94f 93%, #956b1b 94%, #956b1b 100%);
            background: -webkit-radial-gradient(center, ellipse cover,  #c4b56f 0%,#c1a94f 62%,#6b4c14 90%,#c1a94f 93%,#956b1b 94%,#956b1b 100%);
            background: radial-gradient(ellipse at center,  #c4b56f 0%,#c1a94f 62%,#6b4c14 90%,#c1a94f 93%,#956b1b 94%,#956b1b 100%);
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#c4b56f', endColorstr='#956b1b',GradientType=1 );
        }

        .game {
            display: grid;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            place-content: center;
            background-color: rgba(8, 10, 12, 0.998);
            transition: opacity 0.4s ease-in-out;
            z-index: 100;
        }

        .game.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game__card {
            background-color: var(--color-beige);
            color: var(--color-black);
            padding: 1.4rem 2rem;
            text-align: center;
        }

        .game__buttons {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .game__button {
            background-color: transparent;
            padding: 0;
            border: none;
        }

        .game__button svg {
            width: 48px;
            fill: var(--color-black);
            transition: fill 0.2s;
        }

        .game__button:hover svg,
        .game__button:focus svg {
            fill: var(--color-pink);
        }

        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .difficulty-btn {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .difficulty-btn.active {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .easy-btn {
            background-color: #68a691;
            color: white;
        }

        .intermediate-btn {
            background-color: #d8c99b;
            color: var(--color-black);
        }

        .hard-btn {
            background-color: #ca6680;
            color: white;
        }

        .results {
            background-color: var(--color-black);
            color: var(--color-green-light);
            padding: 0.8rem;
            font-family: 'Zen Dots', cursive;
            font-size: 1.2rem;
            letter-spacing: 1px;
            text-align: center;
            text-transform: uppercase;
            margin-top: 1.2rem;
        }

        .score {
            background-color: var(--color-green-light);
            font-size: 1.4rem;
            text-align: center;
            padding: 1rem;
        }

        .restart {
            display: block;
            margin: 0 auto;
            color: var(--color-black);
            background-color: var(--color-pink-light);
            font-size: 1.5rem;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            padding: 0.4rem 1rem 0.2rem;
            margin-top: 1rem;
        }

        .restart:hover,
        .restart:focus {
            background-color: var(--color-green-light);
        }

        .finger-code {
            margin-top: 3rem;
            text-align: center;
            background-color: var(--color-black);
            color: var(--color-beige);
            padding: 0.5rem;
            font-family: 'Zen Dots', cursive;
            letter-spacing: 1px;
        }

        /* Timer styles */
        .timer-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(8, 10, 12, 0.8);
            color: var(--color-pink);
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Zen Dots', cursive;
            font-size: 1.5rem;
            z-index: 10;
        }

        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-icon {
            margin-right: 8px;
        }

        /* Sound controls */
        .sound-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(8, 10, 12, 0.8);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }

        .sound-controls button {
            background: none;
            border: none;
            color: var(--color-green-light);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .sound-controls input[type="range"] {
            width: 100px;
        }

        /* Leaderboard styles */
        .leaderboard {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--color-beige);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            max-width: 90%;
            width: 400px;
            display: none;
        }

        .leaderboard h2 {
            font-family: 'Zen Dots', cursive;
            color: var(--color-black);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard th, .leaderboard td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid var(--color-black);
        }

        .leaderboard th {
            font-weight: bold;
        }

        .leaderboard-close {
            display: block;
            margin: 1rem auto 0;
            padding: 0.5rem 1rem;
            background-color: var(--color-pink-light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Broken shape effect */
        .broken-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
            display: none;
        }

        .crack {
            position: absolute;
            background-color: rgba(255, 0, 0, 0.7);
            transform-origin: center;
        }
    </style>
</head>
<body>
    <div class="container container-canvas">
        <canvas></canvas>
        <div class="broken-effect" id="broken-effect"></div>
    </div>
    <div class="container">
        <div class="results">Results:</div>
        <div class="score"></div>
        <button class="restart">Start Over</button>
        <button id="show-leaderboard" style="display: block; margin: 1rem auto;">Show Leaderboard</button>
    </div>
    <section class="game">
        <div class="game__card">
            <h1>Select Difficulty</h1>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy-btn active" data-difficulty="easy">Easy</button>
                <button class="difficulty-btn intermediate-btn" data-difficulty="intermediate">Intermediate</button>
                <button class="difficulty-btn hard-btn" data-difficulty="hard">Hard</button>
            </div>
            <h1>Select Your Shape</h1>
            <div class="game__buttons" id="easy-shapes">
                <button class="game__button game__button-triangle" aria-label="Triangle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <path d="M329.6 24c-18.4-32-64.7-32-83.2 0L6.5 440c-18.4 31.9 4.6 72 41.6 72H528c36.9 0 60-40 41.6-72l-240-416zM48 464L288 48l240 416H48z" />
                    </svg>
                </button>
                <button class="game__button game__button-circle" aria-label="Circle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200z" />
                    </svg>
                </button>
                <button class="game__button game__button-square" aria-label="Square">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-16 368H64V96h320v304z"/>
                    </svg>
                </button>
                <button class="game__button game__button-heart" aria-label="Heart">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/>
                    </svg>
                </button>
            </div>
            <div class="game__buttons" id="intermediate-shapes" style="display: none;">
                <button class="game__button game__button-star" aria-label="Star">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <path d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z" />
                    </svg>
                </button>
                <button class="game__button game__button-umbrella" aria-label="Umbrella">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <path d="M575.2 253.8C546.3 132.5 434.3 57.7 312 48.9V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v24.9C142.1 57.6 30.5 131.8.8 253.7c-5.9 23.6 22.3 43.8 43.6 25.5l.5-.4c49.2-45.8 89.5-28.1 125.3 27.7 11.3 17.8 34.8 16.9 45.6 0 13.5-20.9 27.6-40.2 48.2-48.8V440c0 13.2-10.8 24-24 24-10.2 0-19.3-6.4-22.7-16-4.4-12.5-18.1-19-30.6-14.6s-19 18.1-14.6 30.6c10.2 28.7 37.4 48 67.9 48 39.7 0 72-32.3 72-72V258c25.9 10.8 38 32.6 48.2 48.5 10.8 16.9 34.2 17.8 45.6 0 36.2-56 76.6-73.1 125.4-27.7l.5.4c21.1 18.2 49.3-1.7 43.5-25.4zm-191.4 1.5c-24-30-56.8-50.3-95.8-50.3-39.4 0-69.7 18.7-94.6 49.9-35.7-44.3-82.8-57.1-122.7-46.8C115 134.8 202 96 288 96c85.6 0 173.8 39 217.8 112.8-47.9-13.8-89.8 8.1-122 46.5z" />
                    </svg>
                </button>
                <button class="game__button game__button-pentagon" aria-label="Pentagon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M512 183.8v144.4c0 15.5-12.5 28.1-28 28.1l-143.7.3-71.1 142.5c-6.6 13.2-20.5 13.2-27.1 0l-71.1-142.5-143.7-.3c-15.5 0-28-12.6-28-28.1V183.8c0-15.5 12.5-28.1 28-28.1h143.9l71.1-142.5c6.6-13.2 20.5-13.2 27.1 0l71.1 142.5h143.9c15.5 0 28 12.6 28 28.1z"/>
                    </svg>
                </button>
                <button class="game__button game__button-diamond" aria-label="Diamond">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path d="M242.2 8.3c-9.6-11.1-26.8-11.1-36.4 0l-200 232c-7.8 9-7.8 22.3 0 31.3l200 232c9.6 11.1 26.8 11.1 36.4 0l200-232c7.8-9 7.8-22.3 0-31.3l-200-232z"/>
                    </svg>
                </button>
            </div>
            <div class="game__buttons" id="hard-shapes" style="display: none;">
                <button class="game__button game__button-flower" aria-label="Flower">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M461.5 256c12.9 12.9 12.9 33.9 0 46.8-23.5 23.5-61.8 23.5-85.3 0-12.9-12.9-33.9-12.9-46.8 0-12.9 12.9-12.9 33.9 0 46.8 23.5 23.5 23.5 61.8 0 85.3-12.9 12.9-12.9 33.9 0 46.8 33.8 33.8 89 33.8 122.8 0 33.8-33.8 33.8-89 0-122.8-12.9-12.9-12.9-33.9 0-46.8 12.9-12.9 33.9-12.9 46.8 0 23.5-23.5 23.5-61.8 0-85.3-12.9-12.9-12.9-33.9 0-46.8 12.9-12.9 33.9-12.9 46.8 0 23.5-23.5 23.5-61.8 0-85.3-12.9-12.9-12.9-33.9 0-46.8 33.8-33.8 89-33.8 122.8 0 33.8 33.8 33.8 89 0 122.8zm-122.8-46.8c12.9-12.9 33.9-12.9 46.8 0 23.5 23.5 61.8 23.5 85.3 0 12.9-12.9 12.9-33.9 0-46.8-33.8-33.8-89-33.8-122.8 0-12.9 12.9-12.9 33.9 0 46.8zm46.8 46.8c-12.9-12.9-33.9-12.9-46.8 0-23.5 23.5-61.8 23.5-85.3 0-12.9-12.9-33.9-12.9-46.8 0-12.9 12.9-12.9 33.9 0 46.8 23.5 23.5 23.5 61.8 0 85.3-12.9 12.9-12.9 33.9 0 46.8 33.8 33.8 89 33.8 122.8 0 33.8-33.8 33.8-89 0-122.8zM256 157.3c-12.9-12.9-33.9-12.9-46.8 0-23.5 23.5-61.8 23.5-85.3 0-12.9-12.9-12.9-33.9 0-46.8 33.8-33.8 89-33.8 122.8 0 12.9 12.9 12.9 33.9 0 46.8-23.5 23.5-61.8 23.5-85.3 0-12.9-12.9-33.9-12.9-46.8 0-12.9 12.9-12.9 33.9 0 46.8 23.5 23.5 23.5 61.8 0 85.3-12.9 12.9-12.9 33.9 0 46.8 33.8 33.8 89 33.8 122.8 0 33.8-33.8 33.8-89 0-122.8-12.9-12.9-12.9-33.9 0-46.8 12.9-12.9 33.9-12.9 46.8 0 23.5-23.5 23.5-61.8 0-85.3-12.9-12.9-12.9-33.9 0-46.8 12.9-12.9 33.9-12.9 46.8 0 23.5-23.5 23.5-61.8 0-85.3-12.9-12.9-12.9-33.9 0-46.8 33.8-33.8 89-33.8 122.8 0 33.8 33.8 33.8 89 0 122.8zm-122.8 46.8c12.9-12.9 33.9-12.9 46.8 0 23.5 23.5 61.8 23.5 85.3 0 12.9-12.9 12.9-33.9 0-46.8-33.8-33.8-89-33.8-122.8 0-12.9 12.9-12.9 33.9 0 46.8z"/>
                    </svg>
                </button>
                <button class="game__button game__button-spiral" aria-label="Spiral">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm0-360c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 280c-66.3 0-120-53.7-120-120s53.7-120 120-120 120 53.7 120 120-53.7 120-120 120zm0-200c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80zm0 120c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40z"/>
                    </svg>
                </button>
                <button class="game__button game__button-bolt" aria-label="Bolt">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                        <path d="M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.1 267.3 9.4 288 32 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"/>
                    </svg>
                </button>
                <button class="game__button game__button-cross" aria-label="Cross">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                        <path d="M352 128h-96V32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96H32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32h96v224c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V256h96c17.7 0 32-14.3 32-32v-64c0-17.7-14.3-32-32-32z"/>
                    </svg>
                </button>
            </div>
            <h2>Use Your Mouse to Trace<br>Score 75+% to Pass</h2>
        </div>
    </section>
    
    <!-- Timer display -->
    <div class="timer-container">
        <div class="timer">
            <span class="timer-icon">‚è±</span>
            <span id="timer-display">05:00</span>
        </div>
    </div>
    
    <!-- Sound controls -->
    <div class="sound-controls">
        <button id="sound-toggle">üîä</button>
        <input type="range" id="volume-control" min="0" max="100" value="60">
    </div>
    
    <div class="finger-code">THE FINGER CODE</div>

    <!-- Leaderboard -->
    <div class="leaderboard" id="leaderboard">
        <h2>LEADERBOARD</h2>
        <table id="leaderboard-table">
            <thead>
                <tr>
                    <th>Shape</th>
                    <th>Difficulty</th>
                    <th>Time</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Entries will be added here -->
            </tbody>
        </table>
        <button class="leaderboard-close" id="close-leaderboard">Close</button>
    </div>

    <!-- Audio elements -->
    <audio id="background-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="success-voice">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="break-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-glass-break-with-fall-1182.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Game variables
        const container = document.querySelector('.container');
        const bounds = container.getBoundingClientRect();
        const candyCanvas = document.querySelector('canvas');
        const ctx = candyCanvas.getContext('2d');
        const brokenEffect = document.getElementById('broken-effect');
        const leaderboard = document.getElementById('leaderboard');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const showLeaderboardBtn = document.getElementById('show-leaderboard');
        const closeLeaderboardBtn = document.getElementById('close-leaderboard');

        // UI elements
        const buttonTriangle = document.querySelector('.game__button-triangle');
        const buttonCircle = document.querySelector('.game__button-circle');
        const buttonSquare = document.querySelector('.game__button-square');
        const buttonHeart = document.querySelector('.game__button-heart');
        const buttonStar = document.querySelector('.game__button-star');
        const buttonUmbrella = document.querySelector('.game__button-umbrella');
        const buttonPentagon = document.querySelector('.game__button-pentagon');
        const buttonDiamond = document.querySelector('.game__button-diamond');
        const buttonFlower = document.querySelector('.game__button-flower');
        const buttonSpiral = document.querySelector('.game__button-spiral');
        const buttonBolt = document.querySelector('.game__button-bolt');
        const buttonCross = document.querySelector('.game__button-cross');
        
        const easyShapes = document.getElementById('easy-shapes');
        const intermediateShapes = document.getElementById('intermediate-shapes');
        const hardShapes = document.getElementById('hard-shapes');
        
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        
        const gameStart = document.querySelector('.game');
        const score = document.querySelector('.score');
        const restart = document.querySelector('.restart');
        const timerDisplay = document.getElementById('timer-display');
        const soundToggle = document.getElementById('sound-toggle');
        const volumeControl = document.getElementById('volume-control');
        const backgroundMusic = document.getElementById('background-music');
        const successVoice = document.getElementById('success-voice');
        const breakSound = document.getElementById('break-sound');

        // Game state
        let mouseDown = false;
        let startedTurn = false;
        let brokeShape = false;
        let prevX = null;
        let prevY = null;
        let pixelsShape = 0;
        let timeLeft = 300;
        let timerInterval;
        let startTime;
        let currentShape = '';
        let currentDifficulty = 'easy';
        let audioContext;
        let cuttingSoundBuffer;
        let successSoundBuffer;
        let failureSoundBuffer;
        let isCuttingSoundPlaying = false;
        let cuttingSoundSource = null;
        let isSoundOn = true;
        let gameResults = [];

        // Initialize the game
        setupCanvas();
        initSound();
        setupLeaderboard();
        setupDifficultyButtons();

        // Set up the size and line styles of the canvas
        function setupCanvas() {
            candyCanvas.height = 370;
            candyCanvas.width = 370;
            candyCanvas.style.width = `${candyCanvas.width}px`;
            candyCanvas.style.height = `${candyCanvas.height}px`;
            ctx.lineWidth = 15;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        // Set up difficulty buttons
        function setupDifficultyButtons() {
            difficultyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    difficultyButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    // Set current difficulty
                    currentDifficulty = this.dataset.difficulty;
                    
                    // Show appropriate shapes
                    easyShapes.style.display = 'none';
                    intermediateShapes.style.display = 'none';
                    hardShapes.style.display = 'none';
                    
                    if (currentDifficulty === 'easy') {
                        easyShapes.style.display = 'flex';
                    } else if (currentDifficulty === 'intermediate') {
                        intermediateShapes.style.display = 'flex';
                    } else if (currentDifficulty === 'hard') {
                        hardShapes.style.display = 'flex';
                    }
                });
            });
        }

        // Shape drawing functions
        function drawTriangle() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Triangle';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.moveTo(185, 85);
            ctx.lineTo(285, 260);
            ctx.lineTo(85, 260);
            ctx.closePath();
            ctx.stroke();
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawCircle() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Circle';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.arc(185, 185, 100, 0, 2 * Math.PI);
            ctx.stroke();
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawSquare() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Square';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.rect(100, 100, 170, 170);
            ctx.stroke();
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawHeart() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Heart';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw heart shape
            ctx.beginPath();
            ctx.moveTo(185, 120);
            ctx.bezierCurveTo(185, 80, 135, 50, 120, 80);
            ctx.bezierCurveTo(100, 120, 185, 170, 185, 170);
            ctx.bezierCurveTo(185, 170, 270, 120, 250, 80);
            ctx.bezierCurveTo(235, 50, 185, 80, 185, 120);
            ctx.closePath();
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawStar() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Star';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            let rot = Math.PI / 2 * 3;
            let x, y;
            const cx = 185, cy = 185;
            const spikes = 5;
            const outerRadius = 100;
            const innerRadius = 40;
            const step = Math.PI / 5;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;
                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.stroke();
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawUmbrella() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Umbrella';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.arc(185, 165, 100, Math.PI, 0, false);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(85, 165);
            ctx.lineTo(185, 50);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(285, 165);
            ctx.lineTo(185, 50);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(185, 165);
            ctx.lineTo(185, 300);
            ctx.stroke();
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawPentagon() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Pentagon';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw pentagon
            ctx.beginPath();
            const centerX = 185;
            const centerY = 185;
            const radius = 100;
            const sides = 5;
            
            for (let i = 0; i <= sides; i++) {
                const angle = (i * 2 * Math.PI / sides) - Math.PI/2;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawDiamond() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Diamond';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw diamond
            ctx.beginPath();
            ctx.moveTo(185, 85);
            ctx.lineTo(285, 185);
            ctx.lineTo(185, 285);
            ctx.lineTo(85, 185);
            ctx.closePath();
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawFlower() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Flower';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw flower shape
            const centerX = 185;
            const centerY = 185;
            const petalRadius = 30;
            const centerRadius = 40;
            const petals = 8;
            
            // Draw petals
            for (let i = 0; i < petals; i++) {
                const angle = (i * 2 * Math.PI / petals);
                const petalX = centerX + (centerRadius + petalRadius) * Math.cos(angle);
                const petalY = centerY + (centerRadius + petalRadius) * Math.sin(angle);
                
                ctx.beginPath();
                ctx.arc(petalX, petalY, petalRadius, 0, 2 * Math.PI);
                ctx.stroke();
            }
            
            // Draw center circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, centerRadius, 0, 2 * Math.PI);
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawSpiral() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Spiral';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw spiral
            ctx.beginPath();
            const centerX = 185;
            const centerY = 185;
            const turns = 3;
            const maxRadius = 100;
            
            for (let i = 0; i <= 360 * turns; i++) {
                const angle = i * Math.PI / 180;
                const radius = maxRadius * (i / (360 * turns));
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawBolt() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Bolt';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw lightning bolt
            ctx.beginPath();
            ctx.moveTo(185, 85);
            ctx.lineTo(135, 185);
            ctx.lineTo(185, 185);
            ctx.lineTo(135, 285);
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawCross() {
            resetGameState();
            gameStart.classList.add('hidden');
            currentShape = 'Cross';
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            drawCandyBackground();
            ctx.strokeStyle = 'rgb(66, 10, 0)';
            ctx.lineWidth = 15;
            
            // Draw cross
            ctx.beginPath();
            // Vertical line
            ctx.moveTo(185, 85);
            ctx.lineTo(185, 285);
            // Horizontal line
            ctx.moveTo(85, 185);
            ctx.lineTo(285, 185);
            ctx.stroke();
            
            pixelsShape = getPixelAmount(66, 10, 0);
            startTimer();
            initAudio();
        }

        function drawCandyBackground() {
            ctx.fillStyle = '#c4b56f';
            ctx.beginPath();
            ctx.arc(185, 185, 185, 0, 2 * Math.PI);
            ctx.fill();
        }

        // Game logic functions
        function getPixelColor(x, y) {
            const pixels = ctx.getImageData(0, 0, candyCanvas.width, candyCanvas.height);
            let index = (Math.floor(y) * (pixels.width * 4)) + (Math.floor(x) * 4);
            return {
                r: pixels.data[index],
                g: pixels.data[index + 1],
                b: pixels.data[index + 2],
                a: pixels.data[index + 3]
            };
        }

        function paint(x, y) {
            let color = getPixelColor(x, y);
            if (color.r === 0 && color.g === 0 && color.b === 0) {
                score.textContent = "FAILURE - You broke the shape";
                brokeShape = true;
                playFailureSound();
                showBrokenEffect();
            } else {
                ctx.strokeStyle = 'rgb(247, 226, 135)';
                ctx.lineWidth = 15;
                ctx.beginPath();
                if (prevX !== null && prevY !== null) {
                    ctx.moveTo(prevX, prevY);
                }
                ctx.lineTo(x, y);
                ctx.stroke();
                prevX = x;
                prevY = y;
            }
        }

        function getPixelAmount(r, g, b) {
            const pixelsData = ctx.getImageData(0, 0, candyCanvas.width, candyCanvas.height);
            const allPixels = pixelsData.data.length;
            let amount = 0;
            for (let i = 0; i < allPixels; i += 4) {
                if (pixelsData.data[i] === r &&
                    pixelsData.data[i+1] === g &&
                    pixelsData.data[i+2] === b) {
                    amount++;
                }
            }
            return amount;
        }

        function evaluatePixels() {
            if (!brokeShape) {
                const pixelsTrace = getPixelAmount(247, 226, 135);
                let pixelDifference = pixelsTrace / pixelsShape;
                const percentage = Math.round(pixelDifference * 100);
                const timeUsed = 300 - timeLeft;
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (pixelDifference >= 0.75 && pixelDifference <= 1) {
                    score.textContent = `SUCCESS - You scored ${percentage}%`;
                    playSuccessSound();
                    // Add to leaderboard
                    gameResults.push({
                        shape: currentShape,
                        difficulty: currentDifficulty,
                        time: timeString,
                        score: `${percentage}%`
                    });
                    updateLeaderboard();
                } else {
                    score.textContent = `FAILURE - You cut ${percentage}%`;
                    playFailureSound();
                }
            }
            stopTimer();
        }

        function resetGameState() {
            mouseDown = false;
            startedTurn = false;
            brokeShape = false;
            prevX = null;
            prevY = null;
            hideBrokenEffect();
        }

        // Timer functions
        function startTimer() {
            startTime = Date.now();
            timeLeft = 300;
            updateTimerDisplay();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    score.textContent = "TIME'S UP - You failed!";
                    playFailureSound();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Audio functions
        function initSound() {
            backgroundMusic.volume = 0.6;
            const playPromise = backgroundMusic.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Auto-play prevented:", error);
                    isSoundOn = false;
                    soundToggle.textContent = "üîá";
                });
            }
            
            volumeControl.addEventListener('input', function() {
                backgroundMusic.volume = this.value / 100;
            });
            
            soundToggle.addEventListener('click', function() {
                isSoundOn = !isSoundOn;
                if (isSoundOn) {
                    backgroundMusic.play();
                    soundToggle.textContent = "üîä";
                } else {
                    backgroundMusic.pause();
                    soundToggle.textContent = "üîá";
                }
            });
        }

        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createAudioBuffers();
            } catch (e) {
                console.error("Web Audio API not supported", e);
            }
        }

        function createAudioBuffers() {
            const bufferSize = audioContext.sampleRate * 0.1;
            cuttingSoundBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const cuttingOutput = cuttingSoundBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                cuttingOutput[i] = Math.random() * 2 - 1;
            }

            successSoundBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 1.5, audioContext.sampleRate);
            const successOutput = successSoundBuffer.getChannelData(0);
            for (let i = 0; i < successSoundBuffer.length; i++) {
                const time = i / audioContext.sampleRate;
                successOutput[i] = 0.2 * (
                    Math.sin(2 * Math.PI * 523.25 * time) +
                    Math.sin(2 * Math.PI * 659.25 * time) +
                    Math.sin(2 * Math.PI * 783.99 * time)
                ) * Math.exp(-time * 2);
            }

            failureSoundBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 1.5, audioContext.sampleRate);
            const failureOutput = failureSoundBuffer.getChannelData(0);
            for (let i = 0; i < failureSoundBuffer.length; i++) {
                const time = i / audioContext.sampleRate;
                const freq = 880 * Math.exp(-time * 2);
                failureOutput[i] = 0.3 * Math.sin(2 * Math.PI * freq * time) * Math.exp(-time * 2);
            }
        }

        function playCuttingSound() {
            if (!audioContext || isCuttingSoundPlaying || !isSoundOn) return;
            isCuttingSoundPlaying = true;
            cuttingSoundSource = audioContext.createBufferSource();
            const filter = audioContext.createBiquadFilter();
            filter.type = "bandpass";
            filter.frequency.value = 1000 + Math.random() * 2000;
            filter.Q.value = 1;
            cuttingSoundSource.buffer = cuttingSoundBuffer;
            cuttingSoundSource.connect(filter);
            filter.connect(audioContext.destination);
            cuttingSoundSource.loop = true;
            cuttingSoundSource.start();
        }

        function stopCuttingSound() {
            if (!audioContext || !isCuttingSoundPlaying || !cuttingSoundSource) return;
            isCuttingSoundPlaying = false;
            cuttingSoundSource.stop();
            cuttingSoundSource = null;
        }

        function playSuccessSound() {
            if (!audioContext || !isSoundOn) return;
            const source = audioContext.createBufferSource();
            source.buffer = successSoundBuffer;
            source.connect(audioContext.destination);
            source.start();
            
            // Play success voice
            if (isSoundOn) {
                successVoice.volume = 0.8;
                successVoice.play().catch(e => console.log("Voice play failed:", e));
            }
        }

        function playFailureSound() {
            if (!audioContext || !isSoundOn) return;
            const source = audioContext.createBufferSource();
            source.buffer = failureSoundBuffer;
            source.connect(audioContext.destination);
            source.start();
            
            // Play break sound
            if (isSoundOn) {
                breakSound.volume = 0.6;
                breakSound.play().catch(e => console.log("Break sound failed:", e));
            }
        }

        // Broken shape effect
        function showBrokenEffect() {
            brokenEffect.innerHTML = '';
            brokenEffect.style.display = 'block';
            
            // Create cracks
            for (let i = 0; i < 10; i++) {
                const crack = document.createElement('div');
                crack.className = 'crack';
                
                // Random position and size
                const width = Math.random() * 100 + 50;
                const height = Math.random() * 10 + 2;
                const left = Math.random() * 300;
                const top = Math.random() * 300;
                const angle = Math.random() * 360;
                
                crack.style.width = `${width}px`;
                crack.style.height = `${height}px`;
                crack.style.left = `${left}px`;
                crack.style.top = `${top}px`;
                crack.style.transform = `rotate(${angle}deg)`;
                
                brokenEffect.appendChild(crack);
            }
        }

        function hideBrokenEffect() {
            brokenEffect.style.display = 'none';
        }

        // Leaderboard functions
        function setupLeaderboard() {
            showLeaderboardBtn.addEventListener('click', () => {
                leaderboard.style.display = 'block';
            });
            
            closeLeaderboardBtn.addEventListener('click', () => {
                leaderboard.style.display = 'none';
            });
        }

        function updateLeaderboard() {
            // Clear existing entries
            leaderboardBody.innerHTML = '';
            
            // Add new entries (show latest 5)
            const recentResults = gameResults.slice(-5).reverse();
            
            recentResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.shape}</td>
                    <td>${result.difficulty.charAt(0).toUpperCase() + result.difficulty.slice(1)}</td>
                    <td>${result.time}</td>
                    <td>${result.score}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }

        // Clear canvas function
        function clearCanvas() {
            ctx.clearRect(0, 0, candyCanvas.width, candyCanvas.height);
            gameStart.classList.remove('hidden');
            resetGameState();
            score.textContent = '';
            pixelsShape = 0;
            stopTimer();
        }

        // Event listeners
        candyCanvas.addEventListener('mousemove', handleMouseMove);
        candyCanvas.addEventListener('mousedown', handleMouseDown);
        candyCanvas.addEventListener('mouseup', handleMouseUp);
        candyCanvas.addEventListener('mouseleave', handleMouseUp);

        buttonTriangle.addEventListener('click', drawTriangle);
        buttonCircle.addEventListener('click', drawCircle);
        buttonSquare.addEventListener('click', drawSquare);
        buttonHeart.addEventListener('click', drawHeart);
        buttonStar.addEventListener('click', drawStar);
        buttonUmbrella.addEventListener('click', drawUmbrella);
        buttonPentagon.addEventListener('click', drawPentagon);
        buttonDiamond.addEventListener('click', drawDiamond);
        buttonFlower.addEventListener('click', drawFlower);
        buttonSpiral.addEventListener('click', drawSpiral);
        buttonBolt.addEventListener('click', drawBolt);
        buttonCross.addEventListener('click', drawCross);
        
        restart.addEventListener('click', clearCanvas);

        window.addEventListener('beforeunload', () => {
            if (timerInterval) clearInterval(timerInterval);
            if (audioContext) audioContext.close();
        });

        // Mouse event handlers
        function handleMouseMove(e) {
            const rect = candyCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            if (mouseDown) {
                paint(x, y);
                playCuttingSound();
            } else {
                stopCuttingSound();
            }
        }

        function handleMouseDown(e) {
            const rect = candyCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            if (!startedTurn) {
                mouseDown = true;
                startedTurn = true;
                prevX = x;
                prevY = y;
            }
        }

        function handleMouseUp() {
            if (mouseDown) {
                mouseDown = false;
                stopCuttingSound();
                evaluatePixels();
            }
        }
    </script>
</body>
</html>